<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Painel ADM â€” Frutiger Aero LÃ­der</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
 <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>

<script src="database.js"></script>
<script src="auth.js"></script>
  <style>
    .adm-layout{position:relative;z-index:10;max-width:1100px;margin:0 auto;padding:14px 12px 90px;}
    .adm-tabs{display:flex;gap:6px;margin-bottom:14px;}
    .admtab{padding:9px 20px;border-radius:50px;font-family:var(--font);font-size:13px;font-weight:700;cursor:pointer;border:none;background:rgba(255,255,255,.38);color:var(--text-light);transition:var(--trans);}
    .admtab.active{background:linear-gradient(180deg,#55b8ff,#0088ee);color:#fff;box-shadow:0 3px 12px rgba(0,100,255,.35);}
    .adm-section{display:none;} .adm-section.active{display:block;}

    /* User table */
    .user-row{display:flex;align-items:center;gap:12px;padding:12px 16px;border-radius:13px;background:rgba(255,255,255,.5);border:1px solid rgba(255,255,255,.8);margin-bottom:6px;transition:var(--trans);}
    .user-row:hover{background:rgba(255,255,255,.7);}
    .user-row-info{flex:1;}
    .user-row-info strong{font-size:14px;font-weight:800;}
    .user-row-info small{font-size:11px;color:var(--text-light);}
    .user-row-actions{display:flex;gap:6px;flex-wrap:wrap;}

    /* Cards for conquistas / desafios */
    .item-card{padding:16px;border-radius:14px;background:rgba(255,255,255,.5);border:1px solid rgba(255,255,255,.8);margin-bottom:8px;display:flex;align-items:center;gap:14px;}
    .item-card-info{flex:1;}
    .item-card-actions{display:flex;gap:6px;}

    /* Form */
    .adm-form{padding:20px;margin-bottom:14px;}
    .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    .form-field{display:flex;flex-direction:column;gap:5px;}
    .form-field label{font-size:11px;font-weight:800;color:var(--text-light);text-transform:uppercase;letter-spacing:1px;}
    .full-width{grid-column:1/-1;}
  </style>
</head>
<body>
  <div class="bg-sky"></div>
  <div class="aurora aurora-1"></div><div class="aurora aurora-2"></div><div class="aurora aurora-3"></div>
  <div class="bg-bokeh"><div class="bokeh b1"></div><div class="bokeh b2"></div><div class="bokeh b3"></div><div class="bokeh b4"></div><div class="bokeh b5"></div><div class="bokeh b6"></div></div>
  <header id="global-header" class="glass"></header>

  <div class="adm-layout">
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
      <div class="orb orb-md orb-pink">âš™ï¸</div>
      <div><h1 style="font-size:20px;font-weight:900;">Painel Administrativo</h1>
        <p style="font-size:12px;color:var(--text-light);">Gerencie usuÃ¡rios, conquistas, desafios e metas</p>
      </div>
    </div>

    <div class="adm-tabs">
      <button class="admtab active" onclick="switchAdmTab('usuarios',this)">ğŸ‘¥ UsuÃ¡rios</button>
      <button class="admtab" onclick="switchAdmTab('conquistas',this)">ğŸ… Conquistas</button>
      <button class="admtab" onclick="switchAdmTab('desafios',this)">âš¡ Desafios</button>
      <button class="admtab" onclick="switchAdmTab('metas',this)">ğŸ¯ Metas Pessoais</button>
    </div>

    <!-- USUÃRIOS -->
    <div class="adm-section active glass" id="adm-usuarios" style="padding:20px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;">
        <p class="section-title">ğŸ‘¥ Todos os UsuÃ¡rios</p>
        <div style="display:flex;gap:8px;">
          <button class="btn btn-blue btn-sm" onclick="filterUsers('all')" id="filter-all">Todos</button>
          <button class="btn btn-sm" style="background:rgba(255,255,255,.4);border:1px solid rgba(255,255,255,.7);" onclick="filterUsers('pending')" id="filter-pending">â³ Pendentes</button>
        </div>
      </div>
      <div id="users-list"></div>
    </div>

    <!-- CONQUISTAS -->
    <div class="adm-section" id="adm-conquistas">
      <!-- Form criar -->
      <div class="glass adm-form">
        <p class="section-title">ğŸ… Nova Conquista</p>
        <div class="form-grid">
          <div class="form-field">
            <label>Ãcone (emoji)</label>
            <div class="input-wrap"><input type="text" id="c-icone" class="aero-input" style="padding-left:14px;" placeholder="ğŸ†" maxlength="4"></div>
          </div>
          <div class="form-field">
            <label>Nome</label>
            <div class="input-wrap"><input type="text" id="c-nome" class="aero-input" style="padding-left:14px;" placeholder="Vendedor do MÃªs"></div>
          </div>
          <div class="form-field full-width">
            <label>DescriÃ§Ã£o</label>
            <div class="input-wrap"><input type="text" id="c-desc" class="aero-input" style="padding-left:14px;" placeholder="Vendeu mais de 20 planos em um mÃªs"></div>
          </div>
          <div class="form-field">
            <label>XP BÃ´nus</label>
            <div class="input-wrap"><input type="number" id="c-xp" class="aero-input" style="padding-left:14px;" placeholder="100" min="0"></div>
          </div>
        </div>
        <button class="btn btn-green mt-16" onclick="createConquista()">+ Criar Conquista</button>
      </div>
      <div class="glass" style="padding:20px;">
        <p class="section-title">Lista de Conquistas</p>
        <div id="conquistas-list"></div>
      </div>
    </div>

    <!-- DESAFIOS -->
    <div class="adm-section" id="adm-desafios">
      <div class="glass adm-form">
        <p class="section-title">âš¡ Novo Desafio RelÃ¢mpago</p>
        <div class="form-grid">
          <div class="form-field">
            <label>TÃ­tulo</label>
            <div class="input-wrap"><input type="text" id="d-titulo" class="aero-input" style="padding-left:14px;" placeholder="CafÃ© da manhÃ£ solidÃ¡rio"></div>
          </div>
          <div class="form-field">
            <label>Tipo</label>
            <select id="d-tipo" class="aero-select" onchange="toggleHashtagField()">
              <option value="hashtag">Hashtag no post</option>
              <option value="manual">AprovaÃ§Ã£o manual</option>
            </select>
          </div>
          <div class="form-field full-width" id="d-hashtag-wrap">
            <label>Hashtags obrigatÃ³rias (separadas por vÃ­rgula)</label>
            <div class="input-wrap"><input type="text" id="d-hashtags" class="aero-input" style="padding-left:14px;" placeholder="#quelindodia, #meucafezinho, #desafiolider"></div>
          </div>
          <div class="form-field full-width">
            <label>DescriÃ§Ã£o</label>
            <textarea id="d-desc" class="aero-textarea" style="min-height:60px;" placeholder="Poste no Feed Social a foto do seu cafÃ© da manhÃ£..."></textarea>
          </div>
          <div class="form-field">
            <label>XP Recompensa</label>
            <div class="input-wrap"><input type="number" id="d-xp" class="aero-input" style="padding-left:14px;" placeholder="50" min="1"></div>
          </div>
          <div class="form-field">
            <label>Data de expiraÃ§Ã£o (opcional)</label>
            <div class="input-wrap"><input type="datetime-local" id="d-expires" class="aero-input" style="padding-left:14px;"></div>
          </div>
        </div>
        <button class="btn btn-green mt-16" onclick="createDesafio()">âš¡ LanÃ§ar Desafio</button>
      </div>
      <div class="glass" style="padding:20px;">
        <p class="section-title">Desafios Ativos & HistÃ³rico</p>
        <div id="desafios-list"></div>
      </div>
    </div>

    <!-- METAS PESSOAIS -->
    <div class="adm-section" id="adm-metas">
      <div class="glass adm-form">
        <p class="section-title">ğŸ¯ Nova Meta Pessoal</p>
        <div class="form-grid">
          <div class="form-field">
            <label>UsuÃ¡rio</label>
            <select id="m-usuario" class="aero-select"></select>
          </div>
          <div class="form-field">
            <label>TÃ­tulo</label>
            <div class="input-wrap"><input type="text" id="m-titulo" class="aero-input" style="padding-left:14px;" placeholder="Vender 15 vidas essa semana!"></div>
          </div>
          <div class="form-field full-width">
            <label>DescriÃ§Ã£o</label>
            <div class="input-wrap"><input type="text" id="m-desc" class="aero-input" style="padding-left:14px;" placeholder="Meta definida pelo gerente para essa semana."></div>
          </div>
          <div class="form-field">
            <label>Objetivo (nÃºmero)</label>
            <div class="input-wrap"><input type="number" id="m-obj" class="aero-input" style="padding-left:14px;" placeholder="15" min="1"></div>
          </div>
          <div class="form-field">
            <label>XP se completar</label>
            <div class="input-wrap"><input type="number" id="m-xp" class="aero-input" style="padding-left:14px;" placeholder="200" min="1"></div>
          </div>
        </div>
        <button class="btn btn-gold mt-16" onclick="createMeta()">ğŸ¯ Definir Meta</button>
      </div>
      <div class="glass" style="padding:20px;">
        <p class="section-title">Metas Ativas</p>
        <div id="metas-list-adm"></div>
      </div>
    </div>

  </div>

  <div id="taskbar" class="glass"><div class="taskbar-time"></div><div class="taskbar-date"></div></div>

  <script src="database.js"></script>
  <script src="auth.js"></script>
  <script>
    let allUsersAdm = [];

    requireAuth(async userData => {
      if (userData.role !== 'admin') { window.location.href='index.html'; return; }
      renderHeader('admin');
      loadUsers();
      loadConquistasAdm();
      loadDesafiosAdm();
      loadMetasAdm();
      loadUsersForSelect();
    });

    // â”€â”€ Tab switch â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function switchAdmTab(name, btn) {
      document.querySelectorAll('.adm-section').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.admtab').forEach(el => el.classList.remove('active'));
      document.getElementById(`adm-${name}`).classList.add('active');
      btn.classList.add('active');
    }

    // â”€â”€ USERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let currentFilter = 'all';
    function filterUsers(f) { currentFilter = f; renderUsersList(); }

    function loadUsers() {
      db.collection('usuarios').orderBy('criadoEm','desc').onSnapshot(snap => {
        allUsersAdm = snap.docs.map(d => ({ uid: d.id, ...d.data() }));
        renderUsersList();
      });
    }

    function renderUsersList() {
      const el = document.getElementById('users-list');
      el.innerHTML = '';
      const filtered = currentFilter === 'pending'
        ? allUsersAdm.filter(u => !u.aprovado)
        : allUsersAdm;

      filtered.forEach(u => {
        const statusSi = u.status==='online'?{cls:'status-online',lbl:'Online'}:u.status==='intervalo'?{cls:'status-intervalo',lbl:'Intervalo'}:{cls:'status-offline',lbl:'Offline'};
        el.innerHTML += `
          <div class="user-row">
            ${renderAvatar(u,'sm')}
            <div class="user-row-info">
              <strong>${u.nome}</strong> <span class="badge ${u.role==='admin'?'badge-gold':u.tipo==='interno'?'badge-blue':'badge-green'}">${u.role==='admin'?'ğŸ‘‘ Admin':u.tipo==='interno'?'Interno':'AutÃ´nomo'}</span>
              <br><small>${u.email} Â· <span class="status-dot ${statusSi.cls}" style="display:inline-block;"></span> ${statusSi.lbl} Â· ${u.xp||0} XP Â· ${u.aprovado?'âœ… Aprovado':'â³ Pendente'}</small>
            </div>
            <div class="user-row-actions">
              <a href="perfil.html?uid=${u.uid}" class="btn btn-blue btn-sm">ğŸ‘¤ Perfil</a>
              ${!u.aprovado ? `<button class="btn btn-green btn-sm" onclick="aprovarUser('${u.uid}')">âœ… Aprovar</button>` : ''}
              ${u.role!=='admin' ? `<button class="btn btn-gold btn-sm" onclick="setAdmin('${u.uid}',true)">ğŸ‘‘ Tornar Admin</button>` : `<button class="btn btn-sm" style="background:rgba(255,200,0,.2);border:1px solid rgba(255,200,0,.4);" onclick="setAdmin('${u.uid}',false)">Remover Admin</button>`}
              <button class="btn btn-red btn-sm" onclick="deleteUser('${u.uid}','${u.email}')">ğŸ—‘</button>
            </div>
          </div>`;
      });
      if (!filtered.length) el.innerHTML = '<p style="text-align:center;font-size:13px;color:var(--text-light);padding:20px;">Nenhum usuÃ¡rio encontrado.</p>';
    }

    async function aprovarUser(uid) {
      await db.collection('usuarios').doc(uid).update({ aprovado: true });
      showToast('âœ… UsuÃ¡rio aprovado!','success');
    }
    async function setAdmin(uid, val) {
      const ok = await showConfirm(val ? 'Tornar este usuÃ¡rio ADMIN?' : 'Remover permissÃ£o de Admin?');
      if (!ok) return;
      await db.collection('usuarios').doc(uid).update({ role: val ? 'admin' : 'user' });
      showToast(val ? 'ğŸ‘‘ Admin definido!' : 'Admin removido.','info');
    }
    async function deleteUser(uid, email) {
      const ok = await showConfirm(`Excluir usuÃ¡rio ${email}? Isso nÃ£o remove a conta do Firebase Auth.`);
      if (!ok) return;
      await db.collection('usuarios').doc(uid).delete();
      showToast('UsuÃ¡rio removido do banco.','info');
    }

    // â”€â”€ CONQUISTAS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function createConquista() {
      const icone = document.getElementById('c-icone').value.trim() || 'ğŸ…';
      const nome  = document.getElementById('c-nome').value.trim();
      const desc  = document.getElementById('c-desc').value.trim();
      const xp    = parseInt(document.getElementById('c-xp').value) || 0;
      if (!nome) { showToast('Informe o nome da conquista.','error'); return; }
      await db.collection('conquistas').add({ icone, nome, descricao: desc, xpBonus: xp, criadaEm: firebase.firestore.FieldValue.serverTimestamp() });
      ['c-icone','c-nome','c-desc','c-xp'].forEach(id => document.getElementById(id).value = '');
      showToast('ğŸ… Conquista criada!','success');
    }

    function loadConquistasAdm() {
      db.collection('conquistas').orderBy('criadaEm','desc').onSnapshot(snap => {
        const el = document.getElementById('conquistas-list');
        el.innerHTML = '';
        snap.forEach(doc => {
          const c = { id: doc.id, ...doc.data() };
          el.innerHTML += `
            <div class="item-card">
              <span style="font-size:28px;">${c.icone||'ğŸ…'}</span>
              <div class="item-card-info">
                <strong style="font-size:14px;">${c.nome}</strong>
                <p style="font-size:12px;color:var(--text-light);">${c.descricao||''} Â· <strong>+${c.xpBonus||0} XP</strong></p>
              </div>
              <div class="item-card-actions">
                <button class="btn btn-red btn-sm" onclick="deleteItem('conquistas','${c.id}')">ğŸ—‘</button>
              </div>
            </div>`;
        });
        if (snap.empty) el.innerHTML = '<p style="font-size:13px;color:var(--text-light);">Nenhuma conquista cadastrada.</p>';
      });
    }

    // â”€â”€ DESAFIOS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function toggleHashtagField() {
      const tipo = document.getElementById('d-tipo').value;
      document.getElementById('d-hashtag-wrap').style.display = tipo === 'hashtag' ? 'flex' : 'none';
    }

    async function createDesafio() {
      const titulo   = document.getElementById('d-titulo').value.trim();
      const tipo     = document.getElementById('d-tipo').value;
      const desc     = document.getElementById('d-desc').value.trim();
      const xp       = parseInt(document.getElementById('d-xp').value) || 10;
      const expires  = document.getElementById('d-expires').value;
      const hashRaw  = document.getElementById('d-hashtags').value;
      if (!titulo) { showToast('Informe o tÃ­tulo do desafio.','error'); return; }

      const hashtags = tipo === 'hashtag'
        ? hashRaw.split(',').map(h => h.trim().toLowerCase()).filter(Boolean)
        : [];

      const data = {
        titulo, tipo, descricao: desc, xpRecompensa: xp,
        hashtags, ativo: true, completadoPor: {},
        criadaEm: firebase.firestore.FieldValue.serverTimestamp(),
        dataExpiracao: expires ? new Date(expires) : null
      };
      await db.collection('desafios').add(data);

      // Post auto no feed
      await db.collection('posts').add({
        autorUid: currentUser.uid, autorNome: 'âš¡ Sistema â€” Desafio RelÃ¢mpago',
        autorTipo: 'sistema', texto: `âš¡ NOVO DESAFIO: **${titulo}**\n${desc}\n${hashtags.map(h=>`${h}`).join(' ')}\nğŸ† Recompensa: +${xp} XP`,
        fotoBase64: null, hashtags, mencoes: [], curtidas: {}, reacoes: {},
        isDesafio: true, criadoEm: firebase.firestore.FieldValue.serverTimestamp()
      });

      ['d-titulo','d-desc','d-xp','d-hashtags','d-expires'].forEach(id => document.getElementById(id).value = '');
      showToast('âš¡ Desafio lanÃ§ado e postado no feed!','success');
    }

    function loadDesafiosAdm() {
      db.collection('desafios').orderBy('criadaEm','desc').onSnapshot(snap => {
        const el = document.getElementById('desafios-list');
        el.innerHTML = '';
        snap.forEach(doc => {
          const d = { id: doc.id, ...doc.data() };
          const completados = Object.keys(d.completadoPor||{}).length;
          el.innerHTML += `
            <div class="item-card">
              <span style="font-size:24px;">${d.ativo?'âš¡':'âœ…'}</span>
              <div class="item-card-info">
                <strong>${d.titulo}</strong>
                <p style="font-size:12px;color:var(--text-light);">${d.descricao||''}</p>
                <div style="display:flex;gap:6px;margin-top:4px;flex-wrap:wrap;">
                  <span class="badge badge-blue">+${d.xpRecompensa} XP</span>
                  <span class="badge badge-green">${completados} completaram</span>
                  ${d.hashtags?.map(h=>`<span class="badge badge-blue">${h}</span>`).join('')||''}
                  <span class="badge ${d.ativo?'badge-green':'badge-red'}">${d.ativo?'Ativo':'Encerrado'}</span>
                </div>
              </div>
              <div class="item-card-actions">
                <button class="btn ${d.ativo?'btn-red':'btn-green'} btn-sm" onclick="toggleDesafio('${d.id}',${!d.ativo})">${d.ativo?'Encerrar':'Reativar'}</button>
                <button class="btn btn-red btn-sm" onclick="deleteItem('desafios','${d.id}')">ğŸ—‘</button>
              </div>
            </div>`;
        });
        if (snap.empty) el.innerHTML = '<p style="font-size:13px;color:var(--text-light);">Nenhum desafio criado.</p>';
      });
    }

    async function toggleDesafio(id, val) {
      await db.collection('desafios').doc(id).update({ ativo: val });
      showToast(val ? 'âš¡ Desafio reativado!' : 'âœ… Desafio encerrado.','info');
    }

    // â”€â”€ METAS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function loadUsersForSelect() {
      const snap = await db.collection('usuarios').where('aprovado','==',true).get();
      const sel  = document.getElementById('m-usuario');
      sel.innerHTML = '<option value="">Selecione o usuÃ¡rio...</option>';
      snap.forEach(d => {
        const u = d.data();
        sel.innerHTML += `<option value="${d.id}|${u.nome}">${u.nome} (${u.tipo})</option>`;
      });
    }

    async function createMeta() {
      const userVal = document.getElementById('m-usuario').value;
      const titulo  = document.getElementById('m-titulo').value.trim();
      const desc    = document.getElementById('m-desc').value.trim();
      const obj     = parseInt(document.getElementById('m-obj').value) || 1;
      const xp      = parseInt(document.getElementById('m-xp').value) || 50;
      if (!userVal || !titulo) { showToast('Preencha todos os campos.','error'); return; }
      const [uid, nome] = userVal.split('|');

      const metaData = {
        usuarioUid: uid, usuarioNome: nome,
        titulo, descricao: desc, objetivo: obj, progresso: 0,
        xpRecompensa: xp, ativa: true,
        criadaEm: firebase.firestore.FieldValue.serverTimestamp()
      };
      await db.collection('metas').add(metaData);

      // Post no feed
      await db.collection('posts').add({
        autorUid: currentUser.uid, autorNome: 'ğŸ¯ Sistema â€” Nova Meta',
        autorTipo: 'sistema',
        texto: `ğŸ¯ META DEFINIDA para @${nome}:\n"${titulo}"\n${desc}\nğŸ† Recompensa: +${xp} XP se concluir!`,
        fotoBase64: null, hashtags: [], mencoes: [uid],
        curtidas:{}, reacoes:{}, isMeta: true,
        criadoEm: firebase.firestore.FieldValue.serverTimestamp()
      });

      ['m-titulo','m-desc','m-obj','m-xp'].forEach(id => document.getElementById(id).value='');
      document.getElementById('m-usuario').value = '';
      showToast('ğŸ¯ Meta criada e postada no Feed!','success');
    }

    function loadMetasAdm() {
      db.collection('metas').where('ativa','==',true).orderBy('criadaEm','desc').onSnapshot(snap => {
        const el = document.getElementById('metas-list-adm');
        el.innerHTML = '';
        snap.forEach(doc => {
          const m = { id: doc.id, ...doc.data() };
          const pct = Math.min(100, Math.round(((m.progresso||0)/m.objetivo)*100));
          el.innerHTML += `
            <div class="item-card" style="flex-direction:column;align-items:flex-start;gap:8px;">
              <div style="display:flex;align-items:center;gap:12px;width:100%;">
                <span style="font-size:22px;">ğŸ¯</span>
                <div style="flex:1;">
                  <strong>${m.titulo}</strong> <span class="badge badge-blue">${m.usuarioNome}</span>
                  <p style="font-size:12px;color:var(--text-light);">Objetivo: ${m.progresso||0}/${m.objetivo} Â· +${m.xpRecompensa} XP</p>
                </div>
                <div class="item-card-actions">
                  <button class="btn btn-blue btn-sm" onclick="updateMetaProgressAdm('${m.id}',${m.progresso||0},${m.objetivo},'${m.usuarioUid}',${m.xpRecompensa},'${m.titulo}','${m.usuarioNome}')">âœï¸</button>
                  <button class="btn btn-red btn-sm" onclick="deleteItem('metas','${m.id}')">ğŸ—‘</button>
                </div>
              </div>
              <div style="width:100%;">
                <div class="xp-bar-wrap" style="height:10px;"><div class="xp-bar-fill" style="width:${pct}%;background:linear-gradient(90deg,#ffaa00,#ff6600);"></div></div>
                <span style="font-size:10px;color:var(--text-light);">${pct}%</span>
              </div>
            </div>`;
        });
        if (snap.empty) el.innerHTML = '<p style="font-size:13px;color:var(--text-light);">Nenhuma meta ativa.</p>';
      });
    }

    async function updateMetaProgressAdm(metaId, current, max, userUid, xpBonus, titulo, nome) {
      const val = prompt(`Atualizar progresso de ${nome}\n(atual: ${current}, meta: ${max}):`, current);
      if (val === null) return;
      const num = parseInt(val); if (isNaN(num)) return;
      await db.collection('metas').doc(metaId).update({ progresso: num });
      if (num >= max) {
        await addXP(userUid, xpBonus, `Meta concluÃ­da: ${titulo}`);
        await db.collection('metas').doc(metaId).update({ ativa: false, concluidaEm: firebase.firestore.FieldValue.serverTimestamp() });
        showToast(`ğŸ‰ Meta concluÃ­da! +${xpBonus} XP para ${nome}!`, 'success', 5000);
      } else { showToast('Progresso atualizado!','success'); }
    }

    // â”€â”€ Generic delete â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function deleteItem(collection, id) {
      const ok = await showConfirm('Excluir este item permanentemente?');
      if (!ok) return;
      await db.collection(collection).doc(id).delete();
      showToast('Item removido.','info');
    }
  </script>
</body>
</html>
