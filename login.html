<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Login ‚Äî Frutiger Aero L√≠der</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <style>
    body{display:flex;align-items:center;justify-content:center;min-height:100vh;}
    .login-scene{position:relative;z-index:10;width:100%;max-width:440px;padding:16px;}
    .window-chrome{
      background:linear-gradient(180deg,rgba(180,220,255,.75) 0%,rgba(140,195,255,.45) 100%);
      border-bottom:1px solid rgba(255,255,255,.5);
      padding:10px 16px;display:flex;align-items:center;gap:10px;
      border-radius:20px 20px 0 0;
    }
    .dots{display:flex;gap:6px;}
    .dot{width:12px;height:12px;border-radius:50%;box-shadow:0 1px 3px rgba(0,0,0,.25),0 1px 1px rgba(255,255,255,.55) inset;}
    .dot-r{background:linear-gradient(135deg,#ff7070,#cc0000);}
    .dot-y{background:linear-gradient(135deg,#ffdd44,#cc9900);}
    .dot-g{background:linear-gradient(135deg,#88ff66,#33aa00);}
    .chrome-title{font-size:11px;font-weight:800;color:var(--text);letter-spacing:1.5px;margin:0 auto;padding-right:70px;}
    .login-body{padding:32px 36px 36px;display:flex;flex-direction:column;align-items:center;gap:18px;}
    .pulsing-orb{animation:orb-pulse 3s ease-in-out infinite;}
    @keyframes orb-pulse{0%,100%{box-shadow:0 6px 22px rgba(0,100,255,.5),0 2px 8px rgba(255,255,255,.55) inset;}50%{box-shadow:0 10px 36px rgba(0,150,255,.85),0 2px 8px rgba(255,255,255,.55) inset;}}
    .login-title{font-size:22px;font-weight:900;text-align:center;color:var(--text);letter-spacing:1px;line-height:1.3;text-shadow:0 1px 3px rgba(255,255,255,.8);}
    .login-title span{color:#0066cc;}
    .login-sub{font-size:13px;color:var(--text-light);}
    .tabs{display:flex;gap:6px;background:rgba(255,255,255,.35);border-radius:50px;padding:4px;}
    .tab{padding:7px 20px;border-radius:50px;font-family:var(--font);font-size:13px;font-weight:700;cursor:pointer;border:none;background:transparent;color:var(--text-light);transition:var(--trans);}
    .tab.active{background:linear-gradient(180deg,#55b8ff,#0088ee);color:#fff;box-shadow:0 3px 12px rgba(0,100,255,.4);}
    .form-section{width:100%;display:flex;flex-direction:column;gap:12px;}
    .error-msg{color:#cc2200;font-size:12px;min-height:16px;text-align:center;font-weight:600;}
    .pending-msg{background:rgba(255,200,60,.2);border:1px solid rgba(255,180,0,.4);border-radius:12px;padding:12px 16px;font-size:13px;color:#664400;font-weight:600;text-align:center;}
    .reflection{height:6px;background:linear-gradient(180deg,transparent,rgba(255,255,255,.3));border-radius:0 0 20px 20px;}
    .input-no-icon .aero-input{padding-left:14px;}
  </style>
</head>
<body>
  <div class="bg-sky"></div>
  <div class="aurora aurora-1"></div><div class="aurora aurora-2"></div><div class="aurora aurora-3"></div>
  <div class="bg-bokeh"><div class="bokeh b1"></div><div class="bokeh b2"></div><div class="bokeh b3"></div><div class="bokeh b4"></div><div class="bokeh b5"></div><div class="bokeh b6"></div></div>

  <div class="login-scene">
    <div class="glass" style="border-radius:20px;">
      <!-- Window chrome -->
      <div class="window-chrome">
        <div class="dots">
          <span class="dot dot-r"></span><span class="dot dot-y"></span><span class="dot dot-g"></span>
        </div>
        <span class="chrome-title">FRUTIGER AERO L√çDER</span>
      </div>

      <div class="login-body">
        <div class="orb orb-xl orb-blue pulsing-orb" style="font-size:28px;font-weight:900;">FA</div>
        <div class="login-title">FRUTIGER AERO<br><span>L√çDER HUB</span></div>
        <p class="login-sub">Hub Social da Corretora de Sa√∫de</p>

        <!-- Tabs: Entrar / Cadastrar -->
        <div class="tabs">
          <button class="tab active" id="tab-login"  onclick="switchTab('login')">Entrar</button>
          <button class="tab"        id="tab-signup" onclick="switchTab('signup')">Cadastrar</button>
        </div>

        <!-- LOGIN FORM -->
        <div class="form-section" id="form-login">
          <div class="input-wrap">
            <span class="input-icon-left">‚úâÔ∏è</span>
            <input type="email" id="login-email" placeholder="E-mail" class="aero-input">
          </div>
          <div class="input-wrap">
            <span class="input-icon-left">üîí</span>
            <input type="password" id="login-pass" placeholder="Senha" class="aero-input">
          </div>
          <button class="btn btn-blue btn-lg w-full" onclick="doLogin()">Entrar no Sistema ‚Üí</button>
        </div>

        <!-- SIGNUP FORM -->
        <div class="form-section hidden" id="form-signup">
          <div class="input-wrap">
            <span class="input-icon-left">üë§</span>
            <input type="text" id="signup-nome" placeholder="Nome completo" class="aero-input">
          </div>
          <div class="input-wrap">
            <span class="input-icon-left">‚úâÔ∏è</span>
            <input type="email" id="signup-email" placeholder="E-mail" class="aero-input">
          </div>
          <div class="input-wrap">
            <span class="input-icon-left">üîí</span>
            <input type="password" id="signup-pass" placeholder="Senha (m√≠n. 6 caracteres)" class="aero-input">
          </div>
          <div class="input-wrap input-no-icon">
            <select id="signup-tipo" class="aero-select" style="padding-left:14px;">
              <option value="">Selecione seu tipo...</option>
              <option value="interno">Funcion√°rio Interno</option>
              <option value="autonomo">Corretor Aut√¥nomo</option>
            </select>
          </div>
          <button class="btn btn-green btn-lg w-full" onclick="doSignup()">Criar Conta ‚Üí</button>
          <div class="pending-msg hidden" id="pending-notice">
            ‚úÖ Conta criada! Aguarde a aprova√ß√£o do Administrador para acessar o sistema.
          </div>
        </div>

        <p class="error-msg" id="auth-error"></p>
      </div>
      <div class="reflection"></div>
    </div>
  </div>

  <div id="taskbar" class="glass"><div class="taskbar-time"></div><div class="taskbar-date"></div></div>

  <script type="module" src="database.js"></script>
  <script src="auth.js"></script>
  <script>
    // Redirect if already logged in
    auth.onAuthStateChanged(async user => {
      if (!user) return;
      const doc = await db.collection('usuarios').doc(user.uid).get();
      if (doc.exists && doc.data().aprovado) window.location.href = 'index.html';
    });

    function switchTab(tab) {
      document.getElementById('form-login').classList.toggle('hidden', tab !== 'login');
      document.getElementById('form-signup').classList.toggle('hidden', tab !== 'signup');
      document.getElementById('tab-login').classList.toggle('active', tab === 'login');
      document.getElementById('tab-signup').classList.toggle('active', tab === 'signup');
      document.getElementById('auth-error').textContent = '';
      document.getElementById('pending-notice').classList.add('hidden');
    }

    async function doLogin() {
      const email = document.getElementById('login-email').value.trim();
      const pass  = document.getElementById('login-pass').value;
      const errEl = document.getElementById('auth-error');
      errEl.textContent = '';
      if (!email || !pass) { errEl.textContent = 'Preencha e-mail e senha.'; return; }
      try {
        const cred = await auth.signInWithEmailAndPassword(email, pass);
        const doc  = await db.collection('usuarios').doc(cred.user.uid).get();
        if (!doc.exists || !doc.data().aprovado) {
          await auth.signOut();
          errEl.textContent = '‚è≥ Conta pendente de aprova√ß√£o pelo administrador.';
          return;
        }
        window.location.href = 'index.html';
      } catch(e) {
        errEl.textContent = e.code === 'auth/wrong-password' || e.code === 'auth/user-not-found'
          ? 'E-mail ou senha incorretos.' : 'Erro: ' + e.message;
      }
    }

    async function doSignup() {
      const nome  = document.getElementById('signup-nome').value.trim();
      const email = document.getElementById('signup-email').value.trim();
      const pass  = document.getElementById('signup-pass').value;
      const tipo  = document.getElementById('signup-tipo').value;
      const errEl = document.getElementById('auth-error');
      errEl.textContent = '';
      if (!nome || !email || !pass || !tipo) { errEl.textContent = 'Preencha todos os campos.'; return; }
      if (pass.length < 6) { errEl.textContent = 'Senha deve ter ao menos 6 caracteres.'; return; }
      try {
        const cred = await auth.createUserWithEmailAndPassword(email, pass);
        await db.collection('usuarios').doc(cred.user.uid).set({
          nome, email, tipo,
          role: 'user',
          aprovado: false,
          xp: 0, nivel: 1,
          status: 'offline',
          fotoPerfil: null, fotoCapa: null,
          bio: '', humor: '',
          conquistas: [],
          fotosDestaque: [],
          isLiderDoMes: false,
          criadoEm: firebase.firestore.FieldValue.serverTimestamp()
        });
        await auth.signOut();
        document.getElementById('form-signup').classList.add('hidden');
        document.getElementById('pending-notice').classList.remove('hidden');
      } catch(e) {
        errEl.textContent = e.code === 'auth/email-already-in-use'
          ? 'Este e-mail j√° est√° cadastrado.' : 'Erro: ' + e.message;
      }
    }

    // Enter key
    document.addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        if (!document.getElementById('form-login').classList.contains('hidden')) doLogin();
        else doSignup();
      }
    });
  </script>
</body>
</html>
