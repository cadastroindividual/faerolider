<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Hub â€” Frutiger Aero LÃ­der</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="database.js"></script>
  <script type="module">
    import { requireAuth } from "./auth.js";
    window.requireAuth = requireAuth;
  </script>
</head>
<body>
  <div class="bg-sky"></div>
  <header id="global-header" class="glass" style="padding:15px 30px;display:flex;justify-content:space-between;align-items:center;">
    <h1 style="font-size:18px;font-weight:900;">HUB SOCIAL</h1>
    <div id="user-header" style="display:flex;align-items:center;gap:12px;"></div>
  </header>

  <div class="hub-layout" style="display:grid;grid-template-columns:260px 1fr 260px;gap:15px;padding:15px;">
    <!-- SIDEBAR ESQUERDA -->
    <aside class="glass" style="padding:15px;">
      <p class="section-title">âš¡ Ferramentas</p>
      <button class="tool-btn" onclick="location.href='feed.html'">ğŸ“° Feed Social</button>
      <button class="tool-btn">ğŸ“Š CotaÃ§Ã£o</button>
      <button class="tool-btn">ğŸ“‚ CarÃªncia</button>
      <button class="tool-btn">ğŸ“‹ Repique</button>
      <div id="master-tools" class="hidden">
        <hr style="margin:10px 0;opacity:0.2;">
        <button class="tool-btn" style="background:rgba(255,215,0,0.2);border-color:rgba(255,215,0,0.5);" onclick="location.href='admin.html'">ğŸ‘‘ Painel MASTER</button>
      </div>
    </aside>

    <!-- CENTRO: RANKINGS -->
    <section style="display:flex;flex-direction:column;gap:15px;">
      <div class="glass" style="padding:20px;">
        <h2 style="font-size:16px;font-weight:900;margin-bottom:15px;">ğŸ† Ranking de Performance (Mensal)</h2>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
          <div>
            <p class="section-title">ğŸ¢ Equipe Interna</p>
            <div id="rank-interno"></div>
          </div>
          <div>
            <p class="section-title">ğŸš€ Corretores AutÃ´nomos</p>
            <div id="rank-corretor"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- SIDEBAR DIREITA: LÃDERES DO MÃŠS -->
    <aside style="display:flex;flex-direction:column;gap:15px;">
      <div class="glass lider-destaque" style="padding:15px;text-align:center;">
        <p class="section-title">â­ FuncionÃ¡rio do MÃªs</p>
        <div id="lider-interno-card"></div>
      </div>
      <div class="glass lider-destaque" style="padding:15px;text-align:center;">
        <p class="section-title">ğŸŒŸ Corretor do MÃªs</p>
        <div id="lider-corretor-card"></div>
      </div>
    </aside>
  </div>

  <script>
    window.requireAuth(userData => {
      document.getElementById('user-header').innerHTML = `
        <span>OlÃ¡, <strong>${userData.nome}</strong></span>
        ${renderAvatar(userData, 'sm')}
      `;
      if (userData.role === 'MASTER' || userData.role === 'admin') {
        document.getElementById('master-tools').classList.remove('hidden');
      }
      loadRankings();
      loadLideres();
    });

    function loadRankings() {
      // Interno
      db.collection('usuarios').where('tipo','==','INTERNO').where('aprovado','==',true).orderBy('xp','desc').limit(5).onSnapshot(snap => {
        const el = document.getElementById('rank-interno');
        el.innerHTML = '';
        snap.forEach(doc => {
          const u = doc.data();
          el.innerHTML += `<div class="glass-sm" style="padding:8px;margin-bottom:5px;display:flex;align-items:center;gap:10px;">
            ${renderAvatar(u, 'sm')} <strong>${u.nome}</strong> <span style="margin-left:auto;">${u.xp || 0} XP</span>
          </div>`;
        });
      });
      // Corretor
      db.collection('usuarios').where('tipo','==','CORRETOR').where('aprovado','==',true).orderBy('xp','desc').limit(5).onSnapshot(snap => {
        const el = document.getElementById('rank-corretor');
        el.innerHTML = '';
        snap.forEach(doc => {
          const u = doc.data();
          el.innerHTML += `<div class="glass-sm" style="padding:8px;margin-bottom:5px;display:flex;align-items:center;gap:10px;">
            ${renderAvatar(u, 'sm')} <strong>${u.nome}</strong> <span style="margin-left:auto;">${u.xp || 0} XP</span>
          </div>`;
        });
      });
    }

    function loadLideres() {
      // FuncionÃ¡rio do MÃªs
      db.collection('usuarios').where('liderInterno','==',true).limit(1).onSnapshot(snap => {
        const el = document.getElementById('lider-interno-card');
        if (snap.empty) { el.innerHTML = '<p>Aguardando definiÃ§Ã£o...</p>'; return; }
        const u = snap.docs[0].data();
        el.innerHTML = `
          ${renderAvatar(u, 'lg')}
          <p style="margin-top:10px;font-weight:900;">${u.nome}</p>
          <small>${u.xp || 0} XP no MÃªs</small>
        `;
      });
      // Corretor do MÃªs
      db.collection('usuarios').where('liderCorretor','==',true).limit(1).onSnapshot(snap => {
        const el = document.getElementById('lider-corretor-card');
        if (snap.empty) { el.innerHTML = '<p>Aguardando definiÃ§Ã£o...</p>'; return; }
        const u = snap.docs[0].data();
        el.innerHTML = `
          ${renderAvatar(u, 'lg')}
          <p style="margin-top:10px;font-weight:900;">${u.nome}</p>
          <small>${u.xp || 0} XP no MÃªs</small>
        `;
      });
    }
  </script>
</body>
</html>
